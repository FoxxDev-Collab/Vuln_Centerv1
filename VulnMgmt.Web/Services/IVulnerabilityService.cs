using VulnMgmt.Web.Models.Domain;

namespace VulnMgmt.Web.Services;

public interface IVulnerabilityService
{
    Task<IEnumerable<HostVulnerability>> GetAllAsync();
    Task<IEnumerable<HostVulnerability>> GetByHostAsync(int hostId);
    Task<IEnumerable<HostVulnerability>> GetBySiteAsync(int siteId);
    Task<HostVulnerability?> GetByIdAsync(int id);
    Task<HostVulnerability> CreateAsync(HostVulnerability vulnerability);
    Task<HostVulnerability> UpdateAsync(HostVulnerability vulnerability);
    Task UpdateRemediationStatusAsync(int id, RemediationStatus status, string? notes, string userName);
    Task DeleteAsync(int id);
    Task<bool> ExistsAsync(int id);
    Task<VulnerabilitySummary> GetSummaryAsync(int? siteId = null);
    Task<IEnumerable<HostVulnerability>> SearchAsync(VulnerabilitySearchCriteria criteria);
}

public class VulnerabilitySummary
{
    public int TotalCount { get; set; }
    public int OpenCount { get; set; }
    public int CriticalOpenCount { get; set; }
    public int HighOpenCount { get; set; }
    public int MediumOpenCount { get; set; }
    public int LowOpenCount { get; set; }
    public int InfoOpenCount { get; set; }
    public int RemediatedCount { get; set; }
    public int AcceptedCount { get; set; }
    public int InProgressCount { get; set; }
}

public class VulnerabilitySearchCriteria
{
    public int? SiteId { get; set; }
    public int? HostId { get; set; }
    public Severity? Severity { get; set; }
    public RemediationStatus? Status { get; set; }
    public string? SearchTerm { get; set; }
    public string? CVE { get; set; }
    public int? PluginId { get; set; }
    public bool? IsExploitable { get; set; }
    public int PageSize { get; set; } = 50;
    public int PageNumber { get; set; } = 1;
}
