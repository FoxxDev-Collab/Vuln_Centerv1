@model VulnMgmt.Web.Models.ViewModels.NistExportAllPreview

<div class="card mb-4">
    <div class="card-header bg-warning text-dark">
        <i class="bi bi-globe me-2"></i>Export Preview: ALL SITES
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-4">
                <div class="card bg-light h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-building display-6 text-warning mb-2"></i>
                        <h2 class="mb-0">@Model.TotalSites</h2>
                        <p class="text-muted mb-0">Sites</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-light h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-pc-display display-6 text-primary mb-2"></i>
                        <h2 class="mb-0">@Model.TotalHosts</h2>
                        <p class="text-muted mb-0">Hosts</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-light h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-clipboard-check display-6 text-success mb-2"></i>
                        <h2 class="mb-0">@Model.TotalStigChecklists</h2>
                        <p class="text-muted mb-0">STIG Checklists</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card bg-light h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-list-check display-6 text-info mb-2"></i>
                        <h2 class="mb-0">@Model.TotalStigRuleResults.ToString("N0")</h2>
                        <p class="text-muted mb-0">STIG Rule Results</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card bg-light h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-bug display-6 text-danger mb-2"></i>
                        <h2 class="mb-0">@Model.TotalNessusVulnerabilities.ToString("N0")</h2>
                        <p class="text-muted mb-0">Nessus Vulnerabilities</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <i class="bi bi-diagram-3 me-2"></i>Compliance Coverage
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <div class="d-flex align-items-center mb-2">
                    <div class="me-3">
                        <span class="badge bg-primary fs-5">@Model.UniqueCciCount</span>
                    </div>
                    <div>
                        <strong>Unique CCIs</strong>
                        <br />
                        <small class="text-muted">Control Correlation Identifiers across all sites</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="d-flex align-items-center mb-2">
                    <div class="me-3">
                        <span class="badge bg-secondary fs-5">
                            @(Model.LastScanDate?.ToString("MMM dd, yyyy") ?? "N/A")
                        </span>
                    </div>
                    <div>
                        <strong>Last Scan Date</strong>
                        <br />
                        <small class="text-muted">Most recent scan across all sites</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <i class="bi bi-list-ul me-2"></i>Sites Included (@Model.SiteBreakdown.Count)
    </div>
    <div class="card-body p-0">
        <table class="table table-sm table-striped mb-0">
            <thead class="table-light">
                <tr>
                    <th>Site Name</th>
                    <th class="text-end">Hosts</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var site in Model.SiteBreakdown)
                {
                    <tr>
                        <td>@site.Name</td>
                        <td class="text-end">@site.HostCount</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <i class="bi bi-file-code me-2"></i>JSON Structure Preview
    </div>
    <div class="card-body">
        <pre class="bg-dark text-light p-3 rounded small" style="max-height: 300px; overflow-y: auto;"><code>{
  "exportMetadata": {
    "exportDate": "@DateTime.UtcNow.ToString("yyyy-MM-ddTHH:mm:ssZ")",
    "exportedBy": "@User.Identity?.Name",
    "exportType": "ATO_COMPLIANCE_PACKAGE_ALL_SITES"
  },
  "summary": {
    "totalSites": @Model.TotalSites,
    "totalHosts": @Model.TotalHosts,
    "stigChecklists": { "totalChecklists": @Model.TotalStigChecklists, ... },
    "nessusVulnerabilities": { "total": @Model.TotalNessusVulnerabilities, ... },
    "cciCoverage": { "totalUniqueCcis": @Model.UniqueCciCount, ... }
  },
  "sites": [
    @foreach (var site in Model.SiteBreakdown.Take(2))
    {
    <text>{
      "name": "@site.Name",
      "hosts": [ ... @site.HostCount hosts ... ]
    },</text>
    }
    ... (@Model.TotalSites total sites)
  ],
  "cciSummary": [
    { "cciId": "CCI-000366", "openFindingCount": 0, ... },
    ... (@Model.UniqueCciCount total)
  ]
}</code></pre>
    </div>
</div>
