using System.ComponentModel.DataAnnotations;
using Microsoft.AspNetCore.Mvc.Rendering;
using VulnMgmt.Web.Models.Domain;
using VulnMgmt.Web.Services;

namespace VulnMgmt.Web.Models.ViewModels;

public class VulnerabilityIndexViewModel
{
    public IEnumerable<VulnerabilityIndexItem> Vulnerabilities { get; set; } = new List<VulnerabilityIndexItem>();
    public VulnerabilitySummary Summary { get; set; } = new();
    public int? SiteId { get; set; }
    public string? SiteName { get; set; }
    public int? HostId { get; set; }
    public string? HostName { get; set; }
    public Severity? SeverityFilter { get; set; }
    public RemediationStatus? StatusFilter { get; set; }
    public string? SearchTerm { get; set; }
    public bool? IsExploitableFilter { get; set; }
    public int PageNumber { get; set; } = 1;
    public int PageSize { get; set; } = 50;
    public int TotalCount { get; set; }
}

public class VulnerabilityIndexItem
{
    public int Id { get; set; }
    public int PluginId { get; set; }
    public string? PluginName { get; set; }
    public string? Family { get; set; }
    public Severity Severity { get; set; }
    public string? CVE { get; set; }
    public string? Synopsis { get; set; }
    public int? Port { get; set; }
    public string? Protocol { get; set; }
    public RemediationStatus RemediationStatus { get; set; }
    public DateTime? LastObserved { get; set; }
    public DateTime? FirstDiscovered { get; set; }
    public bool IsExploitable { get; set; }
    public int HostId { get; set; }
    public string HostName { get; set; } = string.Empty;
    public string SiteName { get; set; } = string.Empty;
}

public class VulnerabilityDetailsViewModel
{
    public HostVulnerability Vulnerability { get; set; } = null!;
    public string HostName { get; set; } = string.Empty;
    public string SiteName { get; set; } = string.Empty;
}

public class UpdateRemediationViewModel
{
    public int Id { get; set; }

    [Display(Name = "Plugin Name")]
    public string? PluginName { get; set; }

    [Display(Name = "Host")]
    public string? HostName { get; set; }

    [Display(Name = "Severity")]
    public Severity Severity { get; set; }

    [Required]
    [Display(Name = "Remediation Status")]
    public RemediationStatus RemediationStatus { get; set; }

    [Display(Name = "Remediation Notes")]
    [StringLength(2000)]
    public string? RemediationNotes { get; set; }

    public string? ReturnUrl { get; set; }
}

public class BulkRemediationViewModel
{
    public List<int> VulnerabilityIds { get; set; } = new();

    [Required]
    [Display(Name = "New Status")]
    public RemediationStatus NewStatus { get; set; }

    [Display(Name = "Notes")]
    [StringLength(2000)]
    public string? Notes { get; set; }

    public int? HostId { get; set; }
    public int? SiteId { get; set; }
}
